function ScratchCard(){if(this.$wrap=$("#scratchCard"),!this.$wrap.length)return null;this.promoid=$PROMOID,this.prizeid=this.$wrap.data("prizeid"),this.winnerid=this.$wrap.data("winnerid"),this.thankcard=this.$wrap.data("thank-card"),this.canvas=$(".canvas",this.$wrap).get(0),this.canvas.width=$(document).width(),this.canvas.height=$(document).height(),this.beginScratch=!1,this.resultStatus=!1,this.$scratchBg=$(".scratch-bg"),Fever.showLoading(),this.init()}ScratchCard.prototype={init:function(){var A=this,t=this.$scratchBg.get(0);t.onload=function(){A.canvas.width=A.$scratchBg.width(),A.canvas.height=A.$scratchBg.height(),A.loadCanvasMask(),A.bindEvent(),Fever.hideLoading()},t.onerror=function(){A.showResult()},t.src=A.$wrap.data("scratch-bg")},bindEvent:function(){this.$wrap.on(Fever.Click,".btn-toResult",{self:this},this.toResultPage),this.$wrap.on(Fever.Click,".btn-toAward",{self:this},this.toAwardPage),this.$scratchBg.get(0).addEventListener("touchmove",this.preventDefault)},preventDefault:function(A){A.preventDefault()},loadCanvasMask:function(){var A=this,t=new Image;t.src="data:image/jpeg;base64,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",t.onload=function(){A.setupCanvas(t)},t.onerror=function(){A.showResult()}},setupCanvas:function(A){function t(A){h.beginScratch||(h.beginScratch=!0,$(".prize-info").show());var t=h.getLocalCoords(h.canvas,A);return n=!0,h.scratchLine.call(h,t.x,t.y,!0),!1}function a(A){if(!n)return!0;var t=h.getLocalCoords(h.canvas,A);return h.scratchLine.call(h,t.x,t.y,!1),!1}function e(A){return!n||(n=!1,!1)}var h=this,n=!1,c=this.canvas.getContext("2d");c.fillStyle=c.createPattern(A,"repeat"),c.fillRect(0,0,this.canvas.width,this.canvas.height),$bg=h.$scratchBg.get(0),$bg.addEventListener(Fever.TouchStart,t),$bg.addEventListener(Fever.TouchMove,a),$bg.addEventListener(Fever.TouchEnd,e)},scratchLine:function(A,t,a){var e=this.canvas.getContext("2d");e.globalCompositeOperation="destination-out",e.lineWidth=45,e.lineCap=e.lineJoin="round",e.strokeStyle="#000",a&&(e.beginPath(),e.moveTo(A+.1,t)),e.lineTo(A,t),e.stroke(),this.diffTransSize()},getLocalCoords:function(A,t){for(var a,e,h,n=0,c=0;null!=A;)n+=A.offsetLeft,c+=A.offsetTop,A=A.offsetParent;return"changedTouches"in t?(a=t.changedTouches[0],e=a.pageX,h=a.pageY):(e=t.pageX,h=t.pageY),{x:e-n,y:h-c}},diffTransSize:function(){var A=this.canvas.getContext("2d");threshold=.2,(threshold>1||threshold<0)&&(threshold=1);for(var t=A.getImageData(0,0,this.canvas.width,this.canvas.height),a=t.data,e=a.length,h=.25*e,n=1,c=0;n<=h;n++)0===a[4*n-1]&&c++;c>h*threshold&&!this.resultStatus&&this.showResult()},showResult:function(){var A=this;A.resultStatus=!0,$(".canvas").fadeOut(1e3,function(){$(".result-info").show().css({"margin-top":-$(".result-info").height()/2+"px"})}),$(".scratch-bg").get(0).removeEventListener("touchmove",A.preventDefault),$.ajax({url:"/m/services/setAward.php",type:"POST",dataType:"json",data:{param:"scratch_flag",promoid:A.promoid,winnerid:A.winnerid,prizeid:A.prizeid,thankcard:A.thankcard}})},toResultPage:function(A){var t=A.data.self,a="/m/promotion_join?promoid="+t.promoid+"&step=joinResult";Fever.redirectUrl(a)},toAwardPage:function(A){var t=A.data.self;Fever.redirectUrl("/m/award?promoid="+t.promoid+"&winnerid="+t.winnerid+"&step=userAward")}},$(function(){new ScratchCard});
//# sourceMappingURL=scratch-card.min.js.map
